{% extends "base.html" %}
{% block content %}
<div class="admin-wrap">
  <!-- Sidebar -->
  <aside class="admin-sidebar">
    <div class="admin-brand"><i class="bi bi-speedometer2"></i> MyShop Admin</div>
    <nav class="nav flex-column admin-nav">
      <a class="nav-link active" href="{{ url_for('admin_dashboard') }}"><i class="bi bi-graph-up"></i> Dashboard</a>
      <a class="nav-link" href="{{ url_for('admin_products') }}"><i class="bi bi-box-seam"></i> Products</a>
      <a class="nav-link" href="{{ url_for('admin_new_product') }}"><i class="bi bi-plus-circle"></i> Add Product</a>
      <a class="nav-link" href="{{ url_for('signout') }}"><i class="bi bi-box-arrow-right"></i> Sign Out</a>
    </nav>
  </aside>

  <!-- Main -->
  <section class="admin-content">
    <div class="admin-header">
      <h5>Dashboard</h5>
      <div class="d-flex gap-2">
        <a class="btn btn-light btn-sm" href="{{ url_for('admin_products') }}"><i class="bi bi-box-seam"></i> Product List</a>
        <a class="btn btn-warning btn-sm" href="{{ url_for('admin_new_product') }}"><i class="bi bi-plus-circle"></i> Add Product</a>
      </div>
    </div>

    <div class="admin-body">
      <!-- KPIs -->
      <div class="row g-3 mb-3">
        <div class="col-md-3"><div class="kpi"><div class="label">Total Products</div><div class="value">{{ total }}</div></div></div>
        <div class="col-md-3"><div class="kpi"><div class="label">Average Price</div><div class="value">${{ '%.2f'|format(avg_price) }}</div></div></div>
        <div class="col-md-3"><div class="kpi"><div class="label">Max Price</div><div class="value">${{ '%.2f'|format(max_price) }}</div></div></div>
        <div class="col-md-3"><div class="kpi"><div class="label">Categories</div><div class="value">{{ by_cat|length }}</div></div></div>
      </div>

      <!-- Charts Row -->
      <div class="row g-3 mb-3">
        <div class="col-lg-8">
          <div class="form-card">
            <h6 class="mb-3">WeekLy Data</h6>
            <canvas id="visitorsChart" height="180"></canvas>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="form-card">
            <h6 class="mb-3">Items by Category</h6>
            <canvas id="byCatChart" height="180"></canvas>
          </div>
        </div>
      </div>

      <!-- Recent Products -->
      <div class="form-card">
        <h6 class="mb-3">Recent Products</h6>
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>#</th><th>Image</th><th>Name</th><th>Category</th><th class="text-end">Price</th>
              </tr>
            </thead>
            <tbody>
            {% for p in recent %}
              <tr>
                <td>{{ p['id'] }}</td>
                <td><img src="{{ p['image_url'] }}" class="thumb-48" alt=""></td>
                <td>{{ p['name'] }}</td>
                <td><span class="badge badge-soft">{{ p['category'] }}</span></td>
                <td class="text-end">${{ '%.2f'|format(p['price']) }}</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Charts -->
<script>
const vc = document.getElementById('visitorsChart');
new Chart(vc, {
  type: 'line',
  data: {
    labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
    datasets: [
      {
        label:'Page Views',
        data:[10,28,22,40,33,90,62],
        borderColor:'#3b82f6',
        backgroundColor:'rgba(59,130,246,0.3)',
        fill:true,
        tension:.35,
        pointBackgroundColor:'#3b82f6'
      },
      {
        label:'Sessions',
        data:[8,18,25,30,27,55,45],
        borderColor:'#ec4899',
        backgroundColor:'rgba(236,72,153,0.25)',
        fill:true,
        tension:.35,
        pointBackgroundColor:'#ec4899'
      }
    ]
  },
  options: {plugins:{legend:{position:'bottom'}}, scales:{y:{beginAtZero:true}}}
});

const bc = document.getElementById('byCatChart');
new Chart(bc, {
  type: 'bar',
  data: {
    labels: [{% for r in by_cat %}'{{ r['category'] }}',{% endfor %}],
    datasets: [{
      data:[{% for r in by_cat %}{{ r['c'] }},{% endfor %}],
      backgroundColor:'rgba(59,130,246,0.7)'
    }]
  },
  options: {
    plugins:{legend:{display:false}},
    scales:{y:{beginAtZero:true}}
  }
});
</script>
{% endblock %}
